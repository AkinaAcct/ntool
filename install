#!/bin/bash

clear

printf "please wait...\n"

for i in git wget curl python dialog bc jq gawk; do
    if [ ! "$(command -v ${i})" ]; then
        pkg install -y ${i}
    fi
done

clear
printf "d8b   db d888888b  .d88b.   .d88b.  db\n"
printf "888o  88 '~~88~~' .8P  Y8. .8P  Y8. 88\n"
printf "88V8o 88    88    88    88 88    88 88\n"
printf "88 V8o88    88    88    88 88    88 88\n"
printf "88  V888    88    '8b  d8' '8b  d8' 88booo.\n"
printf "VP   V8P    YP     'Y88P'   'Y88P'  Y88888P\n"
sleep 0.2
printf "By Nya(https://github.com/nya-main/ntool)\n\n\n"
#这里的字符是由 figlet 生成的

while true; do
    read -r -p "你确定要执行这个脚本吗？  [Y|N]" answer
    case $answer in
    Y | y)
        rm ~/.ntool/local_version >/dev/null 2>&1
        rm -rf "${HOME}/.local/ntool"
        git clone https://github.com/nya-main/ntool.git "${HOME}/.local/ntool"
        if [[ "$(uname -o)" == "Android" ]]; then
            rm ${HOME}/.local/ntool/ntbin/ntool-linux
        else
            rm ${HOME}/.local/ntool/ntbin/ntool
        fi
        echo 'export PATH="${HOME}/.local/ntool/ntbin:${PATH}"' >>${HOME}/.profile
        curl -s https://raw.githubusercontent.com/nnyyaa/ntool/main/version >"${HOME}/.local/ntool/.local_version"
        touch "${HOME}/.local/ntool/.mode"
        echo "NORMAL_MULIT-FILE_MODE" >"${HOME}/.local/ntool/.mode"
        echo "本项目使用的许可证为:Apache License 2.0"
        echo "完成"
        echo "输入ntool测试启动"
        echo "如果无法启动,请重启终端."
        break
        ;;
    N | n)
        echo "exiting..."
        break
        ;;
    *)
        echo "未知的输入: \"$answer\" 请确认输入无误"
        ;;
    esac
done
exit 0
